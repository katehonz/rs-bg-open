# Счетоводна система - Frontend

React-базирана счетоводна система за български фирми с пълна поддръжка на НАП изисквания.

## Технологии

- **React 18** - Модерен UI framework
- **Vite 5.4.19** - Бърз build tool
- **Tailwind CSS 3.4.0** - Utility-first CSS framework
- **GraphQL** - API комуникация с backend

## Ключови функционалности

### 1. Сметкоплан (Chart of Accounts)
- Пълен български сметкоплан (221 сметки)
- Синтетични и аналитични сметки
- Търсене и филтриране
- Йерархична структура

### 2. Журнални записи (Journal Entries)
- Създаване на счетоводни записи
- Автоматично балансиране (дебит = кредит)
- Поддръжка на множество валути с BNB курсове
- Количества, мерни единици и единични цени

### 3. Свързани документи (Статии)
**Най-важната функция** - точно като в оригиналния Nim проект:

- **Основен документ** (фактура, протокол и др.)
- **Вторични групи**:
  - Плащане (банка, каса)
  - Разход (складови операции)  
  - ДДС операции
  - Други свързани операции

#### Номериране на статиите:
```
Основна фактура:    00000359
Плащане:           00000359-1
Разход:            00000359-2
ДДС възстановяване: 00000359-3
```

#### Как работи:
1. Създаваш основния документ (фактура)
2. Добавяш нови групи чрез "Добави група"
3. Всяка група има собствени счетоводни редове
4. При запазване се създават отделни записи, но са свързани

### 4. Контрагенти (Counterparts)
- БУЛСТАТ/ЕИК валидация (9 или 13 цифри)
- ДДС номера и регистрация
- Адреси и допълнителна информация
- Възможност за създаване в движение

### 5. Документи и номерация
- **ДДС документи**: 10-цифрено номериране с водещи нули
- **Обикновени документи**: Генерирани номера или ръчно въвеждане
- Поддържани типове:
  - Фактури (ФК)
  - Кредитни известия (КИ)
  - Дебитни известия (ДИ)
  - Протоколи (ПР)
  - ПКО/РКО
  - Банкови извлечения

### 6. Валути и курсове
- BGN (основна валута)
- EUR, USD, GBP
- Автоматично зареждане на курсове от БНБ
- Преизчисляване при смяна на валута

## Структура на проекта

```
src/
├── components/           # React компоненти
│   ├── AccountSelectModal.jsx    # Избор на сметка
│   ├── CounterpartSelectModal.jsx # Избор на контрагент
│   └── AddCounterpartModal.jsx   # Създаване на контрагент
├── pages/               # Страници
│   ├── JournalEntry.jsx         # Главната форма за записи
│   ├── ChartOfAccounts.jsx      # Сметкоплан
│   └── Currencies.jsx           # Валути и курсове
└── App.jsx             # Основно приложение
```

## GraphQL заявки

### Сметки
```graphql
query GetAccounts($companyId: Int!) {
  accountHierarchy(companyId: $companyId) {
    id code name accountType isAnalytical isActive
  }
}
```

### Контрагенти
```graphql
query GetCounterparts($companyId: Int!) {
  counterparts(companyId: $companyId) {
    id name eik vatNumber isVatRegistered
  }
}
```

### Създаване на запис
```graphql
mutation CreateJournalEntry($input: CreateJournalEntryInput!) {
  createJournalEntry(input: $input) {
    id documentNumber description
  }
}
```

## Стартиране на проекта

```bash
# Инсталация
npm install

# Разработка
npm run dev

# Build
npm run build
```

## Особености на българската счетоводна система

### ДДС документи
- Задължително 10-цифрено номериране
- Водещи нули (например: 0000000359)
- Автоматично форматиране при blur

### Свързани операции
Българската счетоводна практика изисква свързване на документи:
- Фактурата е основният документ
- Плащането е отделна статия (-1)
- Складовите операции са отделна статия (-2)
- ДДС операциите са отделна статия (-3)

### Балансиране
Всички операции трябва да са балансирани:
- В рамките на една статия: дебит = кредит
- Общо за всички статии: общ дебит = общ кредит

## Миграция от Leptos

Проектът е мигриран от Leptos (Rust frontend) към React поради:
- Версионни несъвместимости в Leptos екосистемата
- По-добра поддръжка и community в React
- Запазена цялата функционалност

## Връзка с backend

Backend-ът е на Rust (SeaORM + GraphQL) с PostgreSQL база данни.
Всички заявки минават през GraphQL endpoint на `http://localhost:8080/graphql`
