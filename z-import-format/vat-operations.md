# ДДС операции и кодове

## Обща информация

Кодовете на ДДС операциите са съгласно Закона за ДДС (ЗДДС) и Правилника за прилагане на ЗДДС (ППЗДДС). Те се използват за правилното отразяване в ДДС декларациите и регистрите.

## ДДС Регистри

### Регистър 1 - Покупки
Всички получени доставки и внос на стоки

### Регистър 2 - Продажби  
Всички извършени доставки и износ на стоки

## Кодове за ПОКУПКИ (vatRegister: 1)

### Основни операции

| Код | Операция | Описание | ДДС ставка | Право на ДК |
|-----|----------|----------|------------|-------------|
| **01** | Получени доставки с право на пълен данъчен кредит | Стандартни покупки с 20% ДДС | 20% | Да, 100% |
| **02** | Получени доставки с право на пълен данъчен кредит | Доставки с намалена ставка | 9% | Да, 100% |
| **03** | Получени доставки без право на данъчен кредит | Покупки без ДДС или без право на приспадане | 0%/20% | Не |
| **04** | Получени доставки с частичен данъчен кредит | Смесено използване | 20% | Да, частично |
| **05** | Освободени доставки по чл.21-24 ЗДДС | Освободени доставки | 0% | Не |

### Внос и ВОП

| Код | Операция | Описание | ДДС ставка | Право на ДК |
|-----|----------|----------|------------|-------------|
| **06** | Внос от трети страни | Внос извън ЕС | 20% | Да |
| **07** | ВОП по чл.82 ал.1 | Доставки с обратно начисляване | 20% | Да |
| **08** | ВОП по чл.82 ал.2-5 | Специфични ВОП случаи | 20% | Да |
| **09** | Доставки по чл.163а ЗДДС | Доставки на инвестиционно злато | 0% | Не |

### Вътреобщностни придобивания

| Код | Операция | Описание | ДДС ставка | Право на ДК |
|-----|----------|----------|------------|-------------|
| **23** | Получени доставки от ЕС | Вътреобщностни придобивания | 20% | Да |
| **24** | ВОП от ЕС | Триъгълни операции | 20% | Да |
| **25** | Услуги от ЕС по чл.21 | Услуги с място на изпълнение в България | 20% | Да |

### Специални случаи

| Код | Операция | Описание | ДДС ставка | Право на ДК |
|-----|----------|----------|------------|-------------|
| **30** | Корекции по чл.79 | Корекции на приспаднат данъчен кредит | - | - |
| **31** | Годишни корекции | Корекции по чл.79а | - | - |
| **32** | Протоколи по чл.117 | Липсващи документи | 20% | Да |

## Кодове за ПРОДАЖБИ (vatRegister: 2)

### Основни операции

| Код | Операция | Описание | ДДС ставка |
|-----|----------|----------|------------|
| **01** | Облагаеми доставки | Стандартни продажби с 20% ДДС | 20% |
| **02** | Облагаеми доставки | Продажби с намалена ставка | 9% |
| **03** | Облагаеми доставки с нулева ставка - износ | Износ извън ЕС | 0% |
| **04** | Облагаеми доставки с нулева ставка - ВОД | Вътреобщностни доставки | 0% |

### Специални режими

| Код | Операция | Описание | ДДС ставка |
|-----|----------|----------|------------|
| **05** | Туристически услуги | Режим маржа на печалбата | Специална |
| **06** | Освободени доставки по чл.21-24 | Финансови, застрахователни услуги | 0% |
| **07** | Доставки като посредник | Комисионни | 20% |
| **08** | Освободени доставки по чл.25-28 | Медицински, образователни услуги | 0% |

### Международни операции

| Код | Операция | Описание | ДДС ставка |
|-----|----------|----------|------------|
| **09** | Дистанционни продажби | Продажби към крайни потребители в ЕС | 20% |
| **11** | Доставки по чл.163а | Инвестиционно злато | 0% |
| **12** | ВОД към ЕС | Вътреобщностни доставки | 0% |
| **13** | Доставки по чл.82 | Обратно начисляване | 0% |

### Корекции

| Код | Операция | Описание | ДДС ставка |
|-----|----------|----------|------------|
| **20** | Корекции по чл.126 | Кредитни/дебитни известия | - |
| **21** | Корекции за лоши вземания | Несъбираеми вземания | - |

## Специални документи

### Протоколи по чл.117
- Използват се при липса на фактура
- Задължително се начислява ДДС за внасяне и възстановяване
- Код 07 или 08 за покупки в зависимост от основанието

### Кредитни/Дебитни известия
- Отразяват се със същия код като оригиналната операция
- Сумите са с отрицателен знак при кредитни известия
- Задължително поле `isCreditNote: true`

## Примери за определяне на код

### Покупка на материали от български доставчик
```json
{
  "transactionType": "PURCHASE",
  "vatRegister": 1,
  "operationCode": "01",
  "vatRate": 20,
  "deductibleVat": 200.00
}
```

### Продажба на услуги към клиент в България
```json
{
  "transactionType": "SALE",
  "vatRegister": 2,
  "operationCode": "01",
  "vatRate": 20,
  "vatAmount": 1000.00
}
```

### ВОП - строителни услуги (чл.82 ал.1)
```json
{
  "transactionType": "PURCHASE",
  "vatRegister": 1,
  "operationCode": "07",
  "isProtocol": true,
  "vatRate": 20
}
```

### Износ извън ЕС
```json
{
  "transactionType": "SALE",
  "vatRegister": 2,
  "operationCode": "03",
  "vatRate": 0
}
```

## Автоматично определяне на операция

Системата може автоматично да определи ДДС операцията на база:

1. **Контрагент**
   - Местно лице с ДДС номер → код 01
   - Лице от ЕС → код 12 (ВОД) или 23 (ВОП)
   - Лице извън ЕС → код 03 (износ) или 06 (внос)

2. **Тип стока/услуга**
   - Строителни услуги → код 07/08 (ВОП)
   - Медицински услуги → код 08 (освободени)
   - Финансови услуги → код 06 (освободени)

3. **Счетоводни сметки**
   - Сметка 4531 (ДДС за възстановяване) → покупка с право на ДК
   - Сметка 4532 (ДДС за внасяне) → продажба или ВОП
   - Сметка 453 (ДДС без право) → код 03

## Валидационни правила

1. **Балансираност на ДДС**
   - При код 01-02: ДДС = данъчна основа × ставка
   - При код 03, 06, 08: ДДС = 0

2. **Съответствие с контрагент**
   - ВОД (код 04, 12) - изисква ЕС контрагент
   - Износ (код 03) - изисква контрагент извън ЕС

3. **Протоколи**
   - Винаги двойно осчетоводяване (4531 и 4532)
   - Задължителен код 07 или 08

## Честни грешки

1. **Грешен код при ВОП**
   - Решение: Използвайте код 07 за чл.82 ал.1

2. **Липсващ ДДС номер при ВОД**
   - Решение: Изискайте валиден ЕС ДДС номер

3. **Неправилна ставка**
   - Решение: Проверете типа стока/услуга

4. **Объркани регистри**
   - Решение: 1=покупки, 2=продажби