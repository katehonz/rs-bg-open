# SAF-T v1.0.1 –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

## –ü—Ä–µ–≥–ª–µ–¥

–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ SAF-T (Standard Audit File for Tax) —Å–ø–æ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª–Ω–∞—Ç–∞ –æ–¥–æ–±—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ v1.0.1 –∑–∞ –ë—ä–ª–≥–∞—Ä–∏—è. –¢–∞–∑–∏ –≤–µ—Ä—Å–∏—è —â–µ –≤–ª–µ–∑–µ –≤ —Å–∏–ª–∞ –ø—Ä–µ–∑ **2026 –≥–æ–¥–∏–Ω–∞** –∑–∞ –≥–æ–ª–µ–º–∏ —Ñ–∏—Ä–º–∏ —Å –º–∏–ª–∏–æ–Ω–∏ –æ–±–æ—Ä–æ—Ç.

## –ü—Ä–æ–º–µ–Ω–∏ —Å–ø—Ä—è–º–æ –ø—Ä–µ–¥–∏—à–Ω–∞—Ç–∞ –≤–µ—Ä—Å–∏—è

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–æ–º–µ–Ω–∏

#### 1. –ù–æ–≤ Namespace
- **–°—Ç–∞—Ä**: `urn:StandardAuditFile-Tax:BG_2.0`
- **–ù–æ–≤**: `mf:nra:dgti:dxxxx:declaration:v1`

#### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏

**Header –ø—Ä–æ–º–µ–Ω–∏:**
- –î–æ–±–∞–≤–µ–Ω–æ: `AuditFileRegion` (BG-01 –¥–æ BG-28)
- –î–æ–±–∞–≤–µ–Ω–æ: `Ownership` —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ü—Ä–æ–º—è–Ω–∞: `AuditFileDateCreated` –æ—Ç DateTime –∫—ä–º Date
- –î–æ–±–∞–≤–µ–Ω–æ: `HeaderComment` (A/M/O –∑–∞ Annual/Monthly/OnDemand)
- –î–æ–±–∞–≤–µ–Ω–æ: `TaxAccountingBasis` (A/P/BANK/INSURANCE)

**–¢—Ä–∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤–µ:**
1. **Annual (A)** - –ì–æ–¥–∏—à–µ–Ω –æ—Ç—á–µ—Ç —Å –∞–∫—Ç–∏–≤–∏ –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
2. **Monthly (M)** - –ú–µ—Å–µ—á–µ–Ω –æ—Ç—á–µ—Ç —Å –≥–ª–∞–≤–Ω–∞ –∫–Ω–∏–≥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏  
3. **OnDemand (O)** - –ü—Ä–∏ –ø–æ–∏—Å–∫–≤–∞–Ω–µ —Å—ä—Å —Å–∫–ª–∞–¥–æ–≤–∏ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç–∏

**–ê–¥—Ä–µ—Å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `Number` –≤–º–µ—Å—Ç–æ `BuildingNumber`
- `AdditionalAddressDetail` –≤–º–µ—Å—Ç–æ `AddressDetail`
- –î–æ–±–∞–≤–µ–Ω–æ: `AddressType` (–≤–∏–Ω–∞–≥–∏ "StreetAddress")

**–ö–æ–Ω—Ç–∞–∫—Ç–∏:**
- –ü–æ–¥—Ä–æ–±–Ω–∞ `ContactPerson` —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∏–º–µ–Ω–∞ –∏ —Ç–∏—Ç–ª–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ `OtherTitles`

### üìÅ –§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/src/
‚îú‚îÄ‚îÄ entities/saft.rs              # –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ v1.0.1
‚îú‚îÄ‚îÄ services/saft_service.rs      # –°—Ç–∞—Ä–∞ –≤–µ—Ä—Å–∏—è (deprecated)
‚îú‚îÄ‚îÄ services/saft_service_v2.rs   # –ù–æ–≤–∞ –≤–µ—Ä—Å–∏—è v1.0.1
‚îî‚îÄ‚îÄ graphql/saft_resolvers.rs     # –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω GraphQL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

frontend/src/
‚îî‚îÄ‚îÄ pages/SafTExport.jsx          # –ù–æ–≤ UI –∑–∞ v1.0.1

docs/
‚îú‚îÄ‚îÄ SAFT_IMPLEMENTATION.md        # –°—Ç–∞—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ SAFT_V2_IMPLEMENTATION.md     # –¢–∞–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

file/SAFT_BG/                     # –û—Ñ–∏—Ü–∏–∞–ª–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ –ù–ê–ü
‚îú‚îÄ‚îÄ BG_SAFT_Schema_V_1.0.1.xsd    # XSD —Å—Ö–µ–º–∞ v1.0.1
‚îú‚îÄ‚îÄ SAF-T_BG_Structure_Definition_V_1.0.1.xlsx
‚îî‚îÄ‚îÄ VS_SAMPLE_AuditFile_*.xml     # –ü—Ä–∏–º–µ—Ä–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ
```

## GraphQL API

### –ù–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```graphql
input SafTExportInput {
  companyId: Int!
  periodStart: Int!        # –ú–µ—Å–µ—Ü 1-12
  periodStartYear: Int!
  periodEnd: Int!          # –ú–µ—Å–µ—Ü 1-12  
  periodEndYear: Int!
  fileType: String!        # "Annual", "Monthly", "OnDemand"
  taxAccountingBasis: String! # "A", "P", "BANK", "INSURANCE"
}

type SafTExportResult {
  success: Boolean!
  fileContent: String
  fileName: String!
  errorMessage: String
}
```

### –ü—Ä–∏–º–µ—Ä–∏ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ

**–ú–µ—Å–µ—á–µ–Ω –æ—Ç—á–µ—Ç –∑–∞ –Ω–æ–µ–º–≤—Ä–∏-–¥–µ–∫–µ–º–≤—Ä–∏ 2024:**
```json
{
  "companyId": 1,
  "periodStart": 11,
  "periodStartYear": 2024,
  "periodEnd": 12,
  "periodEndYear": 2024,
  "fileType": "Monthly",
  "taxAccountingBasis": "A"
}
```

## Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ù–æ–≤–∏ –ø–æ–ª–µ—Ç–∞:
- –ò–∑–±–æ—Ä –Ω–∞ –Ω–∞—á–∞–ª–µ–Ω –º–µ—Å–µ—Ü/–≥–æ–¥–∏–Ω–∞
- –ò–∑–±–æ—Ä –Ω–∞ –∫—Ä–∞–µ–Ω –º–µ—Å–µ—Ü/–≥–æ–¥–∏–Ω–∞  
- –¢–∏–ø —Ñ–∞–π–ª (–ú–µ—Å–µ—á–µ–Ω/–ì–æ–¥–∏—à–µ–Ω/–ü—Ä–∏ –ø–æ–∏—Å–∫–≤–∞–Ω–µ)
- –¢–∏–ø —Å—á–µ—Ç–æ–≤–æ–¥—Å—Ç–≤–æ (–¢—ä—Ä–≥–æ–≤—Å–∫–∏/–ë—é–¥–∂–µ—Ç–Ω–∏/–ë–∞–Ω–∫–∏/–ó–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª–∏)

### –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏ –∏–º–µ–Ω–∞ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ:
`saft_{company_id}_{start_year}_{start_month}_to_{end_year}_{end_month}.xml`

–ü—Ä–∏–º–µ—Ä: `saft_1_2024_11_to_2024_12.xml`

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–∏–ø—Å–≤–∞—â–∏ –¥–∞–Ω–Ω–∏

### –ê–¥—Ä–µ—Å–∏
–ü—Ä–∏ –ª–∏–ø—Å–≤–∞—â–∏ –∞–¥—Ä–µ—Å–∏ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç default —Å—Ç–æ–π–Ω–æ—Å—Ç–∏:
- `street_name`: "–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –∞–¥—Ä–µ—Å"
- `city`: "–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –≥—Ä–∞–¥" (–∏–ª–∏ "–°–æ—Ñ–∏—è" –∑–∞ –∫–æ–º–ø–∞–Ω–∏–∏)
- `country`: "BG"

### –ö–æ–Ω—Ç–∞–∫—Ç–∏
–ü—Ä–∏ –ª–∏–ø—Å–≤–∞—â–∏ –¥–∞–Ω–Ω–∏ —Å–µ —Å—ä–∑–¥–∞–≤–∞—Ç –ø—Ä–∞–∑–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Å–ø–æ—Ä–µ–¥ XSD –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è—Ç–∞.

## –í–∞–ª–∏–¥–∞—Ü–∏—è

–°—ä–∑–¥–∞–¥–µ–Ω —Ç–µ—Å—Ç —Ñ–∞–π–ª `frontend/test_saft_v1_0_1.xml` –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ—â—É –æ—Ñ–∏—Ü–∏–∞–ª–Ω–∞—Ç–∞ XSD —Å—Ö–µ–º–∞:

```bash
xmllint --schema ./file/SAFT_BG/BG_SAFT_Schema_V_1.0.1.xsd frontend/test_saft_v1_0_1.xml --noout
```

### –ò–∑–≤–µ—Å—Ç–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑–∞ –¥–æ–≤—ä—Ä—à–≤–∞–Ω–µ:
1. –†–µ–¥–∞ –Ω–∞ XML –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –≤ `Contact` —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞
2. –ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤ `Company` 
3. `Ownership` —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥–∏ `DefaultCurrencyCode`
4. –ü—Ä–∞–∑–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ (`Customers`, `Suppliers`) —Ç—Ä—è–±–≤–∞—Ç –º–∏–Ω–∏–º—É–º 1 –µ–ª–µ–º–µ–Ω—Ç

## –°—Ç–∞—Ç—É—Å

### ‚úÖ –ó–∞–≤—ä—Ä—à–µ–Ω–æ:
- [x] –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Å–ø–æ—Ä–µ–¥ v1.0.1
- [x] –ù–æ–≤–∞ —Å–µ—Ä–≤–∏–∑–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] GraphQL API –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
- [x] Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–∏–ø—Å–≤–∞—â–∏ –¥–∞–Ω–Ω–∏
- [x] –û—Å–Ω–æ–≤–Ω–æ XML –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–µ—â—É XSD —Å—Ö–µ–º–∞

### üîÑ –ó–∞ –¥–æ–≤—ä—Ä—à–≤–∞–Ω–µ (–ø—Ä–µ–¥–∏ 2026):
- [ ] –ö–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ XML –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ —Å–ø–æ—Ä–µ–¥ XSD –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏
- [ ] –ü–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–ª–µ—Ç–∞
- [ ] Ownership —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
- [ ] –¢–µ—Å—Ç–≤–∞–Ω–µ —Å –≥–æ–ª–µ–º–∏ –æ–±–µ–º–∏ –¥–∞–Ω–Ω–∏
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç –∑–∞ –º–∏–ª–∏–æ–Ω–Ω–∏ –æ–±–æ—Ä–æ—Ç–∏

## –í–Ω–µ–¥—Ä—è–≤–∞–Ω–µ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ

**–¢–∞–π–º–ª–∞–π–Ω:** –î–æ 2026 –≥. –∑–∞ —Ñ–∏—Ä–º–∏ —Å –≥–æ–ª–µ–º–∏ –æ–±–æ—Ä–æ—Ç–∏

**–°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏:**
1. –î–æ–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ XML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞  
2. –¢–µ—Å—Ç–≤–∞–Ω–µ —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç —Ç–µ—Å—Ç–æ–≤–µ
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ù–ê–ü —Å–∏—Å—Ç–µ–º–∏—Ç–µ

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—ä–∑–¥–∞–¥–µ–Ω–∞: 05.09.2024*  
*–í–µ—Ä—Å–∏—è: v1.0.1 (—Ñ–∏–Ω–∞–ª–Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)*